<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Online Store, Interactuar con HTML - Ruben Petit</title>
    <link rel="icon" type="image/x-icon" href="src/media/logo.png" />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="src/css/main.css" />
  </head>

  <body>
    <div class="container-md">
      <div class="row">
        <div class="col">
          <nav class="navbar navbar-expand-lg bg-light">
            <div class="container-fluid">
              <a class="navbar-brand" href="/">
                <img src="src/media/logo.png" alt="Logo" height="50" />
                <h1>Online Store</h1>
              </a>
              <!-- <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <span class="navbar-toggler-icon"></span>
              </button>
              <div
                class="collapse navbar-collapse justify-content-end"
                id="navbarNav"
              >
                <ul class="navbar-nav text-center">
                  <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="/">Inicio</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#store">Tienda</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#contact">Contactanos</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#contact">Sobre Nosotros</a>
                  </li>
                </ul>
              </div> -->
            </div>
          </nav>
        </div>
      </div>
      <div class="row mt-4 mb-4">
        <div class="col">
          <h2 class="text-center">Gracias por tu compra!</h2>
        </div>
      </div>
      <div class="row">
        <div class="col-5 mb-3">
          <h3 class="ms-5">Factura Electronica</h3>
        </div>
        <div class="col-4 d-flex justify-content-end align-items-center">
          <p class="text-muted">
            Fecha de compra: <span class="text-dark" id="infoDate"></span>
          </p>
        </div>
        <div class="col-3 d-flex justify-content-end align-items-center">
          <p class="text-muted">
            Number de Factura:
            <span class="text-dark" id="infoInvoiceNumber"></span>
          </p>
        </div>
        <div class="col-12 mb-3">
          <h5 class="text-center">Informaccion Personal:</h5>
        </div>
        <div class="col-4 text-muted">
          <label for="inputFullName" class="col-form-label"
            >Nombre Completo</label
          >
          <input
            type="text"
            readonly
            class="form-control-plaintext"
            id="inputFullName"
          />
        </div>
        <div class="col-4 text-muted">
          <label for="inputTelephoneNumber" class="col-form-label"
            >Numero Telefonico</label
          >
          <input
            type="text"
            readonly
            class="form-control-plaintext"
            id="inputTelephoneNumber"
          />
        </div>
        <div class="col-4 text-muted">
          <label for="inputEmail" class="col-form-label"
            >Correo Electronico</label
          >
          <input
            type="text"
            readonly
            class="form-control-plaintext"
            id="inputEmail"
          />
        </div>
        <div class="col ms-3 text-muted">
          <label for="inputFullAddress" class="col-form-label"
            >Dirreccion Completa</label
          >
          <input
            type="text"
            readonly
            class="form-control-plaintext"
            id="inputFullAddress"
          />
        </div>
        <div class="col-12 mb-3 mt-3">
          <table class="table table-hover">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Producto</th>
                <th scope="col">Precio</th>
                <th scope="col">Descuento</th>
                <th scope="col">Impuestos</th>
                <th scope="col">Cantidad</th>
                <th scope="col">Total</th>
              </tr>
            </thead>
            <tbody style="overflow: scroll" id="cartItems">
              <tr>
                <td colspan="7" class="text-center">Carrito Vacio</td>
              </tr>
              <tr>
                <td colspan="6">Total Discount</td>
                <td>COP 0</td>
              </tr>
              <tr>
                <td colspan="6">Total IVA</td>
                <td>COP 0</td>
              </tr>
              <tr>
                <td colspan="6">Precio Total</td>
                <td>COP 0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col d-flex justify-content-center">
          <button class="btn btn-secondary" onclick="window.print()">
            Imprimir Factura
          </button>
          <button class="btn btn-primary ms-3" onclick="finish()">
            Finalizar Compra
          </button>
        </div>
      </div>
      <!-- FOOTER -->
      <footer>&copy; Online Store, Todos los derechos reservados.</footer>
      <!-- FOOTER -->
    </div>
    <!-- FIN DE CONTAINER -->
    <script src="./src/moment/moment.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
      crossorigin="anonymous"
    ></script>
    <script>
      function finish() {
        setTimeout(() => {
          localStorage.clear();
          window.location.href = "./index.html";
        }, 1000);
      }
      window.onload = () => {
        let tempProfileInfo = localStorage.getItem("invoiceInfo"),
        tempFullCart = localStorage.getItem("fullCartDB");
        if (tempProfileInfo == null || tempFullCart == null) {
          window.location.href = "./index.html";
        } else {
          tempProfileInfo = JSON.parse(tempProfileInfo);
          console.log(tempProfileInfo[0].dateOfPurchase)
          tempFullCart = JSON.parse(tempFullCart);

          document.getElementById("inputFullName").value =
            tempProfileInfo[0].fullName;
          document.getElementById("inputTelephoneNumber").value =
            tempProfileInfo[0].telephoneNumber;
          document.getElementById("inputEmail").value =
            tempProfileInfo[0].email;
          document.getElementById("inputFullAddress").value =
            tempProfileInfo[0].fullAddress;
          document.getElementById("infoDate").innerHTML =
            tempProfileInfo[0].dateOfPurchase;
          document.getElementById("infoInvoiceNumber").innerHTML =
            "#" + tempProfileInfo[0].invoiceNumber;
          //console.log(tempProfileInfo);


        let tempHTML = document.querySelector("#cartItems")

        //Reseteo de mi codigo HMTL
        tempHTML.innerHTML = ``;
        // Variable que almacena el calculo del precio total
        let tempTotalDiscount = 0;
        let tempTotalTaxes = 0;
        let tempTotalPrice = 0;
        //Midiendo la longitud del carrito
        if (tempFullCart.length > 0) {
            for (let i = 0; i < tempFullCart.length; i++) {
                tempTotalDiscount += tempFullCart[i].discount;
                tempTotalTaxes += tempFullCart[i].taxes;
                tempTotalPrice +=
                (tempFullCart[i].price -
                    tempFullCart[i].discount +
                    tempFullCart[i].taxes) *
                tempFullCart[i].quantity;
                tempHTML.innerHTML += `
                <tr>
                    <td>${tempFullCart[i].id}</td>
                    <td>${tempFullCart[i].title}</td>
                    <td>COP ${tempFullCart[i].price}</td>
                    <td>COP ${tempFullCart[i].discount}</td>
                    <td>COP ${tempFullCart[i].taxes}</td>
                    <td>${tempFullCart[i].quantity}</td>
                    <td>COP ${
                        (tempFullCart[i].price -
                        tempFullCart[i].discount +
                        tempFullCart[i].taxes) *
                        tempFullCart[i].quantity
                    }</td>
                <tr>
                `;
            }
        } else {
            tempHTML.innerHTML += `
            <tr>
                <td colspan="7" class="text-center">Carrito vacio</td>
            <tr>
            `;
        }
        tempHTML.innerHTML += `
            <tr>
                <td colspan="6">Total Discount</td>
                <td>COP ${tempTotalDiscount}</td>
            </tr>
            <tr>
                <td colspan="6">Total IVA</td>
                <td>COP ${tempTotalTaxes}</td>
            </tr>
            <tr>
                <td colspan="6">Precio Total</td>
                <td>COP ${tempTotalPrice}</td>
            </tr>
            `;
        }
      };
    </script>
  </body>
</html>
